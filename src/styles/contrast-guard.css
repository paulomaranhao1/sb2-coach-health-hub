
@layer utilities {
  /* Advanced Contrast Protection System */
  
  /* High Contrast Text Utilities */
  .force-readable {
    color: rgb(15 23 42) !important;
    font-weight: 600 !important;
    text-shadow: none !important;
  }

  .dark .force-readable {
    color: rgb(248 250 252) !important;
    font-weight: 600 !important;
  }

  /* Safe Contrast Classes */
  .contrast-safe {
    background-color: rgb(255 255 255) !important;
    color: rgb(15 23 42) !important;
    border: 1px solid rgb(226 232 240) !important;
    font-weight: 600 !important;
  }

  .dark .contrast-safe {
    background-color: rgb(15 23 42) !important;
    color: rgb(248 250 252) !important;
    border: 1px solid rgb(51 65 85) !important;
    font-weight: 600 !important;
  }

  /* White Background Safety */
  .white-bg-safe * {
    color: rgb(15 23 42) !important;
    font-weight: 600 !important;
  }

  .dark .white-bg-safe * {
    color: rgb(248 250 252) !important;
    font-weight: 600 !important;
  }

  /* Button Contrast Guards */
  .btn-contrast-safe {
    background-color: rgb(59 130 246) !important;
    color: rgb(255 255 255) !important;
    border: none !important;
    font-weight: 600 !important;
  }

  .btn-contrast-safe:hover {
    background-color: rgb(37 99 235) !important;
    color: rgb(255 255 255) !important;
  }

  .dark .btn-contrast-safe {
    background-color: rgb(96 165 250) !important;
    color: rgb(15 23 42) !important;
  }

  .dark .btn-contrast-safe:hover {
    background-color: rgb(147 197 253) !important;
    color: rgb(15 23 42) !important;
  }
}

/* Emergency Contrast Fixes */
@supports (color: white) {
  /* Prevent white text on white backgrounds */
  button:not([class*="bg-red"]):not([class*="bg-blue"]):not([class*="bg-green"]):not([class*="bg-purple"]):not([class*="bg-orange"]) {
    color: rgb(15 23 42) !important;
    font-weight: 600 !important;
  }
  
  .dark button:not([class*="bg-red"]):not([class*="bg-blue"]):not([class*="bg-green"]):not([class*="bg-purple"]):not([class*="bg-orange"]) {
    color: rgb(248 250 252) !important;
  }
}

/* Specific Button Color Guards */
button[class*="bg-purple"],
.magic-link-button,
.purple-button {
  color: rgb(255 255 255) !important;
  background-color: rgb(168 85 247) !important;
  font-weight: 600 !important;
}

button[class*="bg-red"],
.primary-button {
  color: rgb(255 255 255) !important;
  background-color: rgb(239 68 68) !important;
  font-weight: 600 !important;
}

button[class*="bg-green"],
.success-button {
  color: rgb(255 255 255) !important;
  background-color: rgb(34 197 94) !important;
  font-weight: 600 !important;
}

button[class*="bg-blue"],
.info-button {
  color: rgb(255 255 255) !important;
  background-color: rgb(59 130 246) !important;
  font-weight: 600 !important;
}

button[class*="bg-orange"],
.warning-button {
  color: rgb(255 255 255) !important;
  background-color: rgb(249 115 22) !important;
  font-weight: 600 !important;
}

/* Intercept problematic inline styles */
*[style*="color: white"]:not([style*="background"]) {
  color: rgb(15 23 42) !important;
  font-weight: 600 !important;
}

.dark *[style*="color: white"]:not([style*="background"]) {
  color: rgb(248 250 252) !important;
}

/* Universal invisibility prevention */
*:not(svg):not(path):not(g):not(circle):not(rect):not(line) {
  /* Ensure minimum contrast ratio */
}

/* Disabled state contrast */
button:disabled,
button[disabled] {
  opacity: 0.6 !important;
  cursor: not-allowed !important;
}

button:disabled:not([class*="variant-link"]) {
  font-weight: 600 !important;
}
